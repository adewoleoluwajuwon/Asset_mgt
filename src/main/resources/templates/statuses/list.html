<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<th:block th:replace="~{fragments/head :: pwaHead('Page Title')}"></th:block>
<head>
    <meta charset="UTF-8" />
    <title>Asset Statuses</title>

    <link rel="stylesheet" th:href="@{/css/main.css}" />
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
          crossorigin="anonymous">
</head>
<body>
<div class="container my-4">

    <!-- top bar -->
    <div class="d-flex justify-content-between align-items-center mb-2">
        <div class="text-muted small" th:text="${#authentication?.name}">admin</div>
        <a class="text-decoration-none" th:href="@{/dashboard}">&larr; Back to Dashboard</a>
    </div>

    <h2 class="mb-3">Asset Statuses</h2>

    <!-- flash messages -->
    <div th:if="${success}" class="alert alert-success py-2 mb-3" th:text="${success}"></div>
    <div th:if="${error}" class="alert alert-danger py-2 mb-3" th:text="${error}"></div>

    <!-- actions row: create + search -->
    <div class="d-flex flex-wrap gap-2 align-items-center mb-3">
        <a sec:authorize="hasAnyRole('ADMIN_MANAGER','STORE_MANAGER')"
           class="btn btn-primary"
           th:href="@{/statuses/new}">
            Create Status
        </a>

        <form method="get" th:action="@{/statuses/search}" class="ms-auto">
            <div class="input-group">
                <input type="text" class="form-control" name="keyword" placeholder="Searchâ€¦" th:value="${keyword}">
                <button class="btn btn-outline-primary" type="submit">Search</button>
                <a class="btn btn-outline-secondary" th:href="@{/statuses/}">Reset</a>
            </div>
        </form>
    </div>

    <!-- table -->
    <div class="table-responsive">
        <table class="table table-hover align-middle">
            <thead>
            <tr>
                <th style="width:80px">#</th>
                <th>Name</th>
                <th class="text-end" style="width:220px">Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:if="${#lists.isEmpty(statuses)}">
                <td colspan="3" class="text-center text-muted">No statuses found.</td>
            </tr>

            <tr th:each="s, i : ${statuses}">
                <td th:text="${i.index + 1}">1</td>
                <td>
                    <span th:text="${s.statusName}">AVAILABLE</span>
                    <span class="badge bg-secondary ms-2"
                          th:if="${inUseMap[s.id]}">In Use</span>
                </td>
                <td class="text-end">

                    <!-- Edit -->
                    <a class="btn btn-sm btn-outline-primary me-2"
                       th:href="@{/statuses/edit/{id}(id=${s.id})}"
                       th:if="${!inUseMap[s.id]}">
                        Edit
                    </a>
                    <button class="btn btn-sm btn-outline-secondary me-2" disabled
                            th:if="${inUseMap[s.id]}"
                            title="Linked to assets">
                        Edit
                    </button>

                    <!-- Delete -->
                    <a class="btn btn-sm btn-outline-danger"
                       th:href="@{/statuses/delete/{id}(id=${s.id})}"
                       th:if="${!inUseMap[s.id]}"
                       onclick="return confirm('Delete this status?');">
                        Delete
                    </a>
                    <button class="btn btn-sm btn-outline-secondary" disabled
                            th:if="${inUseMap[s.id]}"
                            title="Linked to assets">
                        Delete
                    </button>

                </td>
            </tr>
            </tbody>
        </table>
    </div>

</div>
</body>
</html>
